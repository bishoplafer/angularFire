"use strict";!function(a){var b,c;a.module("firebase",[]).value("Firebase",Firebase),a.module("firebase").factory("$firebase",["$q","$parse","$timeout",function(a,c,d){return function(e){var f=new b(a,c,d,e);return f.construct()}}]),a.module("firebase").filter("orderByPriority",function(){return function(b){var c=[];return b&&(b.$getIndex&&"function"==typeof b.$getIndex?a.forEach(b.$getIndex(),function(d){var e=b[d];null!==e&&(a.isObject(e)&&(e.$id=d),c.push(e))}):a.isArray(b)?c=b.slice(0):a.isObject(b)&&a.forEach(b,function(a){c.push(a)})),c}}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){if(void 0===this||null===this)throw new TypeError("'this' is null or not defined");var c=this.length>>>0;for(b=+b||0,1/0===Math.abs(b)&&(b=0),0>b&&(b+=c,0>b&&(b=0));c>b;b++)if(this[b]===a)return b;return-1}),b=function(a,b,c,d){if(this._q=a,this._parse=b,this._timeout=c,this._bound=!1,this._loaded=!1,this._index=[],this._on={value:[],change:[],loaded:[],child_added:[],child_moved:[],child_changed:[],child_removed:[]},"string"==typeof d)throw new Error("Please provide a Firebase reference instead of a URL, eg: new Firebase(url)");this._fRef=d},b.prototype={construct:function(){var c=this,d=[];return d.$id=c._fRef.ref().name(),d.$bind=function(a,b,d){return c._bind(a,b,d)},d.$add=function(a){function b(a){a?e.reject(a):e.resolve(d)}var d,e=c._q.defer();return d="object"==typeof a?c._fRef.ref().push(c._parseObject(a),b):c._fRef.ref().push(a,b),e.promise},d.$save=function(a){function b(a){a?d.reject(a):d.resolve()}var d=c._q.defer();if(a){var e=c._parseObject(c._object[a]);c._fRef.ref().child(a).set(e,b)}else c._fRef.ref().set(c._parseObject(c._object),b);return d.promise},d.$set=function(a){var b=c._q.defer();return c._fRef.ref().set(c._parseObject(a),function(a){a?b.reject(a):b.resolve()}),b.promise},d.$update=function(a){var b=c._q.defer();return c._fRef.ref().update(c._parseObject(a),function(a){a?b.reject(a):b.resolve()}),b.promise},d.$transaction=function(a,b){var d=c._q.defer();return c._fRef.ref().transaction(a,function(a,b,c){a?d.reject(a):d.resolve(b?c:null)},b),d.promise},d.$remove=function(a){function b(a){a?d.reject(a):d.resolve()}var d=c._q.defer();return a?c._fRef.ref().child(a).remove(b):c._fRef.ref().remove(b),d.promise},d.$child=function(a){var d=new b(c._q,c._parse,c._timeout,c._fRef.ref().child(a));return d.construct()},d.$on=function(a,b){if(!c._on.hasOwnProperty(a))throw new Error("Invalid event type "+a+" specified");return c._sendInitEvent(a,b),"loaded"===a&&this._loaded||c._on[a].push(b),d},d.$off=function(a,b){if(c._on.hasOwnProperty(a))if(b){var d=c._on[a].indexOf(b);-1!==d&&c._on[a].splice(d,1)}else c._on[a]=[];else c._fRef.off()},d.$auth=function(a){var b=c._q.defer();return c._fRef.auth(a,function(a,c){null!==a?b.reject(a):b.resolve(c)},function(a){b.reject(a)}),b.promise},d.$getIndex=function(){return a.copy(c._index)},d.$getRef=function(){return c._fRef.ref()},c._object=d,c._getInitialValue(),c._object},_getInitialValue:function(){function b(b,c){var d=b.name(),e=b.val(),f=g._index.indexOf(d);if(-1!==f&&g._index.splice(f,1),c){var h=g._index.indexOf(c);g._index.splice(h+1,0,d)}else g._index.unshift(d);a.isObject(e)&&null!==b.getPriority()&&(e.$priority=b.getPriority()),g._updateModel(d,e)}function c(a,b){return function(c,d){b(c,d),g._broadcastEvent(a,g._makeEventSnapshot(c.name(),c.val(),d))}}function d(a,b){g._fRef.on(a,c(a,b))}function e(a){g._loaded=!0,g._broadcastEvent("loaded",a)}function f(a){if(g._bound&&null===a){var b=g._parseObject(g._parse(g._name)(g._scope));switch(typeof b){case"string":case"undefined":a="";break;case"number":a=0;break;case"boolean":a=!1}}return a}var g=this;d("child_added",b),d("child_moved",b),d("child_changed",b),d("child_removed",function(a){var b=a.name(),c=g._index.indexOf(b);g._index.splice(c,1),g._updateModel(b,null)}),g._fRef.on("value",function(b){var c=b.val();a.isObject(c)?delete g._object.$value:(c=f(c),g._updatePrimitive(c)),g._broadcastEvent("value",g._makeEventSnapshot(b.name(),c)),g._loaded||e(c)})},_updateModel:function(a,b){null==b?delete this._object[a]:this._object[a]=b,this._broadcastEvent("change",a),this._triggerModelUpdate()},_triggerModelUpdate:function(){if(!this._runningTimer){var b=this;this._runningTimer=b._timeout(function(){if(b._runningTimer=null,b._bound){var c=b._object,d=b._parse(b._name)(b._scope);a.equals(c,d)||b._parse(b._name).assign(b._scope,a.copy(c))}})}},_updatePrimitive:function(b){var c=this;c._timeout(function(){if(c._object.$value&&a.equals(c._object.$value,b)||(c._object.$value=b),c._broadcastEvent("change"),c._bound){var d=c._parseObject(c._parse(c._name)(c._scope));a.equals(d,b)||c._parse(c._name).assign(c._scope,b)}})},_broadcastEvent:function(a,b){function c(a,b){e._timeout(function(){a(b)})}var d=this._on[a]||[];"loaded"===a&&(this._on[a]=[]);var e=this;if(d.length>0)for(var f=0;f<d.length;f++)"function"==typeof d[f]&&c(d[f],b)},_sendInitEvent:function(b,c){var d=this;d._loaded&&["child_added","loaded","value"].indexOf(b)>-1&&d._timeout(function(){var e=a.isObject(d._object)?d._parseObject(d._object):d._object;switch(b){case"loaded":c(e);break;case"value":c(d._makeEventSnapshot(d._fRef.name(),e,null));break;case"child_added":d._iterateChildren(e,function(a,b,e){c(d._makeEventSnapshot(a,b,e))})}})},_iterateChildren:function(b,c){if(this._loaded&&a.isObject(b)){var d=null;for(var e in b)b.hasOwnProperty(e)&&(c(e,b[e],d),d=e)}},_makeEventSnapshot:function(b,c,d){return a.isUndefined(d)&&(d=null),{snapshot:{name:b,value:c},prevChild:d}},_bind:function(b,c,d){var e=this,f=e._q.defer();e._name=c,e._bound=!0,e._scope=b;var g=e._parse(c)(b);void 0!==g&&"object"==typeof g&&e._fRef.ref().update(e._parseObject(g)),b.$on("$destroy",function(){h()}),e._object.$on("loaded",function(a){e._timeout(function(){b[c]=null===a&&"function"==typeof d?d():a,f.resolve(h)})});var h=b.$watch(c,function(){var d=e._parseObject(e._parse(c)(b));void 0!==e._object.$value&&a.equals(d,e._object.$value)||a.equals(d,e._parseObject(e._object))||void 0!==d&&e._loaded&&(e._fRef.set?e._fRef.set(d):e._fRef.ref().update(d))},!0);return f.promise},_parseObject:function(b){function c(a){for(var b in a)a.hasOwnProperty(b)&&("$priority"==b?(a[".priority"]=a.$priority,delete a.$priority):"object"==typeof a[b]&&c(a[b]));return a}var d=c(a.copy(b));return a.fromJson(a.toJson(d))}},a.module("firebase").factory("$firebaseSimpleLogin",["$q","$timeout","$rootScope",function(a,b,d){return function(e){var f=new c(a,b,d,e);return f.construct()}}]),c=function(a,b,c,d){if(this._q=a,this._timeout=b,this._rootScope=c,this._loginDeferred=null,this._getCurrentUserDeferred=[],this._currentUserData=void 0,"string"==typeof d)throw new Error("Please provide a Firebase reference instead of a URL, eg: new Firebase(url)");this._fRef=d},c.prototype={construct:function(){var a={user:null,$login:this.login.bind(this),$logout:this.logout.bind(this),$createUser:this.createUser.bind(this),$changePassword:this.changePassword.bind(this),$removeUser:this.removeUser.bind(this),$getCurrentUser:this.getCurrentUser.bind(this),$sendPasswordResetEmail:this.sendPasswordResetEmail.bind(this)};if(this._object=a,!window.FirebaseSimpleLogin){var b=new Error("FirebaseSimpleLogin is undefined. Did you forget to include firebase-simple-login.js?");throw this._rootScope.$broadcast("$firebaseSimpleLogin:error",b),b}var c=new FirebaseSimpleLogin(this._fRef,this._onLoginEvent.bind(this));return this._authClient=c,this._object},login:function(a,b){var c=this._q.defer(),d=this;return this.getCurrentUser().then(function(){d._loginDeferred=c,d._authClient.login(a,b)}),c.promise},logout:function(){this._authClient.logout(),delete this._currentUserData},createUser:function(a,b){var c=this,d=this._q.defer();return c._authClient.createUser(a,b,function(a,b){a?(c._rootScope.$broadcast("$firebaseSimpleLogin:error",a),d.reject(a)):d.resolve(b)}),d.promise},changePassword:function(a,b,c){var d=this,e=this._q.defer();return d._authClient.changePassword(a,b,c,function(a){a?(d._rootScope.$broadcast("$firebaseSimpleLogin:error",a),e.reject(a)):e.resolve()}),e.promise},getCurrentUser:function(){var a=this,b=this._q.defer();return void 0!==a._currentUserData?b.resolve(a._currentUserData):a._getCurrentUserDeferred.push(b),b.promise},removeUser:function(a,b){var c=this,d=this._q.defer();return c._authClient.removeUser(a,b,function(a){a?(c._rootScope.$broadcast("$firebaseSimpleLogin:error",a),d.reject(a)):d.resolve()}),d.promise},sendPasswordResetEmail:function(a){var b=this,c=this._q.defer();return b._authClient.sendPasswordResetEmail(a,function(a){a?(b._rootScope.$broadcast("$firebaseSimpleLogin:error",a),c.reject(a)):c.resolve()}),c.promise},_onLoginEvent:function(a,b){if(this._currentUserData!==b||null!==a){var c=this;a?(c._loginDeferred&&(c._loginDeferred.reject(a),c._loginDeferred=null),c._rootScope.$broadcast("$firebaseSimpleLogin:error",a)):(this._currentUserData=b,c._timeout(function(){for(c._object.user=b,b?c._rootScope.$broadcast("$firebaseSimpleLogin:login",b):c._rootScope.$broadcast("$firebaseSimpleLogin:logout"),c._loginDeferred&&(c._loginDeferred.resolve(b),c._loginDeferred=null);c._getCurrentUserDeferred.length>0;){var a=c._getCurrentUserDeferred.pop();a.resolve(b)}}))}}}}(angular);